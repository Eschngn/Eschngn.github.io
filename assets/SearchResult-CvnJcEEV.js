import{f as W,u as N,g as X,h as Z,j as ee,t as ae,i as se,k as C,l as f,m as e,n as le,p as te,s as re,R as F,q as ie,v as oe,x as ce,y as ne,z as ue,A as $,B as I,C as de,D as ve,E as he,F as me,L as ye,G as ge,H as pe,I as be,J as M,K as Ee,M as A}from"./app-DqyEfRnh.js";const ke=["/","/intro.html","/essay/","/essay/essay2.html","/essay/four-years-of-college.html","/knowledge-base/","/knowledge-base/database/mysql/explain.html","/knowledge-base/database/mysql/index2.html","/knowledge-base/database/redis/redis1.html","/knowledge-base/database/redis/redis2.html","/knowledge-base/java/basis/basis1.html","/knowledge-base/java/basis/basis2.html","/knowledge-base/java/basis/exception.html","/knowledge-base/java/basis/modifier.html","/knowledge-base/java/basis/string.html","/knowledge-base/java/collection/collection1.html","/knowledge-base/java/collection/collection2.html","/404.html","/knowledge-base/database/mysql/","/knowledge-base/database/","/knowledge-base/database/redis/","/knowledge-base/java/basis/","/knowledge-base/java/","/knowledge-base/java/collection/","/category/","/category/essay/","/category/%E9%9A%8F%E7%AC%94/","/category/%E6%95%B0%E6%8D%AE%E5%BA%93/","/category/mysql/","/category/redis/","/category/java/","/tag/","/tag/%E9%9A%8F%E7%AC%94/","/tag/%E6%A0%A1%E5%9B%AD%E7%94%9F%E6%B4%BB/","/tag/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/","/tag/%E7%B4%A2%E5%BC%95/","/tag/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","/tag/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","/tag/java%E5%9F%BA%E7%A1%80/","/tag/java%E9%9B%86%E5%90%88/","/article/","/star/","/timeline/"],we="SLIMSEARCH_QUERY_HISTORY",p=M(we,[]),fe=()=>{const{queryHistoryCount:t}=A;return{enabled:t>0,queryHistories:p,addQueryHistory:c=>{p.value=Array.from(new Set([c,...p.value.slice(0,t-1)]))},removeQueryHistory:c=>{p.value=[...p.value.slice(0,c),...p.value.slice(c+1)]}}},Q=t=>ke[t.id]+("anchor"in t?`#${t.anchor}`:""),Ae="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=A,b=M(Ae,[]),He=()=>({enabled:T>0,resultHistories:b,addResultHistory:o=>{{const c={link:Q(o),display:o.display};"header"in o&&(c.header=o.header),b.value=[c,...b.value.slice(0,T-1)]}},removeResultHistory:o=>{b.value=[...b.value.slice(0,o),...b.value.slice(o+1)]}}),xe=t=>{const{page:o,routeLocale:c}=de(),H=ve(),r=C(0),E=f(()=>r.value>0),d=he([]);return me(()=>{const{search:x,terminate:m}=ye(),k=pe(y=>{const{resultsFilter:B=l=>l,querySplitter:g,suggestionsFilter:S,...i}=H.value;y?(r.value+=1,x(y,c.value,i).then(l=>B(l,y,c.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},A.searchDelay-A.suggestDelay,{maxWait:5e3});ge([t,c],([y])=>k(y.join(" "))),be(()=>{m()})}),{isSearching:E,results:d}};var qe=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const c=N(),H=X(),r=Z(ee),{addQueryHistory:E,queryHistories:d,removeQueryHistory:x}=fe(),{resultHistories:m,addResultHistory:k,removeResultHistory:y}=He(),B=ae(t,"queries"),{results:g,isSearching:S}=xe(B),i=se({isQuery:!0,index:0}),l=C(0),v=C(0),D=f(()=>d.value.length>0||m.value.length>0),q=f(()=>g.value.length>0),R=f(()=>g.value[l.value]||null),U=()=>{const{isQuery:a,index:s}=i;s===0?(i.isQuery=!a,i.index=a?m.value.length-1:d.value.length-1):i.index=s-1},_=()=>{const{isQuery:a,index:s}=i;s===(a?d.value.length-1:m.value.length-1)?(i.isQuery=!a,i.index=0):i.index=s+1},O=()=>{l.value=l.value>0?l.value-1:g.value.length-1,v.value=R.value.contents.length-1},P=()=>{l.value=l.value<g.value.length-1?l.value+1:0,v.value=0},Y=()=>{v.value<R.value.contents.length-1?v.value+=1:P()},z=()=>{v.value>0?v.value-=1:O()},j=a=>a.map(s=>Ee(s)?s:e(s[0],s[1])),G=a=>{if(a.type==="customField"){const s=ne[a.index]||"$content",[h,n=""]=ue(s)?s[H.value].split("$content"):s.split("$content");return a.display.map(u=>e("div",j([h,...u,n])))}return a.display.map(s=>e("div",j(s)))},w=()=>{l.value=0,v.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,s)=>{const h=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h,onClick:()=>{o("updateQuery",a)}},e("div",[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:n=>{n.preventDefault(),n.stopPropagation(),x(s)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((a,s)=>{const h=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h},e(F,{to:a.link,onClick:()=>{w()}},()=>[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(n=>j(n)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:n=>{n.preventDefault(),n.stopPropagation(),y(s)}})]))}))]));return le("keydown",a=>{if(t.isFocusing){if(q.value){if(a.key==="ArrowUp")z();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const s=R.value.contents[v.value];E(t.queries.join(" ")),k(s),c.push(Q(s)),w()}}else if(a.key==="ArrowUp")U();else if(a.key==="ArrowDown")_();else if(a.key==="Enter"){const{index:s}=i;i.isQuery?(a.preventDefault(),o("updateQuery",d.value[s])):(c.push(m.value[s].link),w())}}}),te([l,v],()=>{var a;(a=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||a.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!q.value:!D.value}]},t.queries.length?S.value?e(re,{hint:r.value.searching}):q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},g.value.map(({title:a,contents:s},h)=>{const n=l.value===h;return e("div",{class:["slimsearch-record",{active:n}],role:"group","aria-selected":n},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((u,V)=>{const L=n&&v.value===V;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e(F,{to:Q(u),onClick:()=>{E(t.queries.join(" ")),k(u),w()}},()=>[u.type==="text"?null:e(u.type==="title"?ie:u.type==="heading"?oe:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[u.type==="text"&&u.header?e("div",{class:"slimsearch-record-content-header"},u.header):null,e("div",G(u))])]))}))])})):r.value.emptyResult:D.value?[J(),K()]:r.value.emptyHistory)}});export{qe as default};
