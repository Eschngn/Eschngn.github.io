import{f as W,u as N,g as X,h as Z,j as ee,t as ae,i as se,k as C,l as f,m as e,n as le,p as te,s as re,R as L,q as ie,v as oe,x as ne,y as ce,z as ue,A as $,B as I,C as de,D as ve,E as he,F as me,L as ye,G as ge,H as pe,I as be,J as M,K as Ee,M as j}from"./app-BoeXlqPp.js";const ke=["/","/intro.html","/essay/","/essay/four-years-of-college.html","/essay/school-recruitment.html","/knowledge-base/","/knowledge-base/database/mysql/explain.html","/knowledge-base/database/mysql/index2.html","/knowledge-base/database/redis/redis1.html","/knowledge-base/database/redis/redis2.html","/knowledge-base/java/basis/annotation.html","/knowledge-base/java/basis/basis1.html","/knowledge-base/java/basis/basis2.html","/knowledge-base/java/basis/exception.html","/knowledge-base/java/basis/generics.html","/knowledge-base/java/basis/modifier.html","/knowledge-base/java/basis/proxy.html","/knowledge-base/java/basis/reflection.html","/knowledge-base/java/basis/string.html","/knowledge-base/java/basis/value-pass.html","/knowledge-base/java/collection/arraylist.html","/knowledge-base/java/collection/collection2.html","/knowledge-base/java/concurrent/synchronized.html","/knowledge-base/java/concurrent/volatile.html","/knowledge-base/java/io/io1.html","/404.html","/knowledge-base/database/mysql/","/knowledge-base/database/","/knowledge-base/database/redis/","/knowledge-base/java/basis/","/knowledge-base/java/","/knowledge-base/java/collection/","/knowledge-base/java/concurrent/","/knowledge-base/java/io/","/category/","/category/%E9%9A%8F%E7%AC%94/","/category/%E6%95%B0%E6%8D%AE%E5%BA%93/","/category/mysql/","/category/redis/","/category/java/","/tag/","/tag/%E6%A0%A1%E5%9B%AD%E7%94%9F%E6%B4%BB/","/tag/%E6%A0%A1%E6%8B%9B%E7%BB%8F%E5%8E%86/","/tag/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/","/tag/%E7%B4%A2%E5%BC%95/","/tag/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","/tag/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","/tag/java%E5%9F%BA%E7%A1%80/","/tag/java%E9%9B%86%E5%90%88/","/tag/java-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/","/tag/java-io/","/article/","/star/","/timeline/"],we="SLIMSEARCH_QUERY_HISTORY",p=M(we,[]),fe=()=>{const{queryHistoryCount:t}=j;return{enabled:t>0,queryHistories:p,addQueryHistory:n=>{p.value=Array.from(new Set([n,...p.value.slice(0,t-1)]))},removeQueryHistory:n=>{p.value=[...p.value.slice(0,n),...p.value.slice(n+1)]}}},Q=t=>ke[t.id]+("anchor"in t?`#${t.anchor}`:""),je="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=j,b=M(je,[]),Be=()=>({enabled:T>0,resultHistories:b,addResultHistory:o=>{{const n={link:Q(o),display:o.display};"header"in o&&(n.header=o.header),b.value=[n,...b.value.slice(0,T-1)]}},removeResultHistory:o=>{b.value=[...b.value.slice(0,o),...b.value.slice(o+1)]}}),Ae=t=>{const{page:o,routeLocale:n}=de(),B=ve(),r=C(0),E=f(()=>r.value>0),d=he([]);return me(()=>{const{search:A,terminate:m}=ye(),k=pe(y=>{const{resultsFilter:H=l=>l,querySplitter:g,suggestionsFilter:S,...i}=B.value;y?(r.value+=1,A(y,n.value,i).then(l=>H(l,y,n.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},j.searchDelay-j.suggestDelay,{maxWait:5e3});ge([t,n],([y])=>k(y.join(" "))),be(()=>{m()})}),{isSearching:E,results:d}};var xe=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const n=N(),B=X(),r=Z(ee),{addQueryHistory:E,queryHistories:d,removeQueryHistory:A}=fe(),{resultHistories:m,addResultHistory:k,removeResultHistory:y}=Be(),H=ae(t,"queries"),{results:g,isSearching:S}=Ae(H),i=se({isQuery:!0,index:0}),l=C(0),v=C(0),D=f(()=>d.value.length>0||m.value.length>0),x=f(()=>g.value.length>0),q=f(()=>g.value[l.value]||null),U=()=>{const{isQuery:a,index:s}=i;s===0?(i.isQuery=!a,i.index=a?m.value.length-1:d.value.length-1):i.index=s-1},_=()=>{const{isQuery:a,index:s}=i;s===(a?d.value.length-1:m.value.length-1)?(i.isQuery=!a,i.index=0):i.index=s+1},O=()=>{l.value=l.value>0?l.value-1:g.value.length-1,v.value=q.value.contents.length-1},P=()=>{l.value=l.value<g.value.length-1?l.value+1:0,v.value=0},Y=()=>{v.value<q.value.contents.length-1?v.value+=1:P()},z=()=>{v.value>0?v.value-=1:O()},R=a=>a.map(s=>Ee(s)?s:e(s[0],s[1])),G=a=>{if(a.type==="customField"){const s=ce[a.index]||"$content",[h,c=""]=ue(s)?s[B.value].split("$content"):s.split("$content");return a.display.map(u=>e("div",R([h,...u,c])))}return a.display.map(s=>e("div",R(s)))},w=()=>{l.value=0,v.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,s)=>{const h=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h,onClick:()=>{o("updateQuery",a)}},e("div",[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),A(s)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((a,s)=>{const h=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h},e(L,{to:a.link,onClick:()=>{w()}},()=>[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(c=>R(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(s)}})]))}))]));return le("keydown",a=>{if(t.isFocusing){if(x.value){if(a.key==="ArrowUp")z();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const s=q.value.contents[v.value];E(t.queries.join(" ")),k(s),n.push(Q(s)),w()}}else if(a.key==="ArrowUp")U();else if(a.key==="ArrowDown")_();else if(a.key==="Enter"){const{index:s}=i;i.isQuery?(a.preventDefault(),o("updateQuery",d.value[s])):(n.push(m.value[s].link),w())}}}),te([l,v],()=>{var a;(a=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||a.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!x.value:!D.value}]},t.queries.length?S.value?e(re,{hint:r.value.searching}):x.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},g.value.map(({title:a,contents:s},h)=>{const c=l.value===h;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((u,V)=>{const F=c&&v.value===V;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e(L,{to:Q(u),onClick:()=>{E(t.queries.join(" ")),k(u),w()}},()=>[u.type==="text"?null:e(u.type==="title"?ie:u.type==="heading"?oe:ne,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[u.type==="text"&&u.header?e("div",{class:"slimsearch-record-content-header"},u.header):null,e("div",G(u))])]))}))])})):r.value.emptyResult:D.value?[J(),K()]:r.value.emptyHistory)}});export{xe as default};
